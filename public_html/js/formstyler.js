(function(e){e.fn.styler=function(t){var t=e.extend({wrapper:"form",idSuffix:"-styler",filePlaceholder:"Файл не выбран",fileBrowse:"Обзор...",selectSearch:true,selectSearchLimit:10,selectSearchNotFound:"Совпадений не найдено",selectSearchPlaceholder:"Поиск...",selectVisibleOptions:0,singleSelectzIndex:"100",selectSmartPositioning:true,onSelectOpened:function(){},onSelectClosed:function(){},onFormStyled:function(){}},t);return this.each(function(){function r(){var e="",r="",i="",s="";if(n.attr("id")!==undefined&&n.attr("id")!="")e=' id="'+n.attr("id")+t.idSuffix+'"';if(n.attr("title")!==undefined&&n.attr("title")!="")r=' title="'+n.attr("title")+'"';if(n.attr("class")!==undefined&&n.attr("class")!="")i=" "+n.attr("class");var o=n.data();for(var u in o){if(o[u]!="")s+=" data-"+u+'="'+o[u]+'"'}e+=s;this.id=e;this.title=r;this.classes=i}var n=e(this);if(n.is(":checkbox")){n.each(function(){if(n.parent("div.jq-checkbox").length<1){function t(){var t=new r;var i=e("<div"+t.id+' class="jq-checkbox'+t.classes+'"'+t.title+'><div class="jq-checkbox__div"></div></div>');n.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(i).prependTo(i);i.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",display:"inline-block",position:"relative",overflow:"hidden"});if(n.is(":checked"))i.addClass("checked");if(n.is(":disabled"))i.addClass("disabled");i.click(function(){if(!i.is(".disabled")){if(n.is(":checked")){n.prop("checked",false);i.removeClass("checked")}else{n.prop("checked",true);i.addClass("checked")}n.change();return false}else{return false}});n.closest("label").add('label[for="'+n.attr("id")+'"]').click(function(e){i.click();e.preventDefault()});n.change(function(){if(n.is(":checked"))i.addClass("checked");else i.removeClass("checked")}).keydown(function(e){if(e.which==32)i.click()}).focus(function(){if(!i.is(".disabled"))i.addClass("focused")}).blur(function(){i.removeClass("focused")})}t();n.on("refresh",function(){n.parent().before(n).remove();t()})}})}else if(n.is(":radio")){n.each(function(){if(n.parent("div.jq-radio").length<1){function i(){var i=new r;var s=e("<div"+i.id+' class="jq-radio'+i.classes+'"'+i.title+'><div class="jq-radio__div"></div></div>');n.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(s).prependTo(s);s.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",display:"inline-block",position:"relative"});if(n.is(":checked"))s.addClass("checked");if(n.is(":disabled"))s.addClass("disabled");s.click(function(){if(!s.is(".disabled")){s.closest(t.wrapper).find('input[name="'+n.attr("name")+'"]').prop("checked",false).parent().removeClass("checked");n.prop("checked",true).parent().addClass("checked");n.change();return false}else{return false}});n.closest("label").add('label[for="'+n.attr("id")+'"]').click(function(e){s.click();e.preventDefault()});n.change(function(){n.parent().addClass("checked")}).focus(function(){if(!s.is(".disabled"))s.addClass("focused")}).blur(function(){s.removeClass("focused")})}i();n.on("refresh",function(){n.parent().before(n).remove();i()})}})}else if(n.is(":file")){n.css({position:"absolute",top:0,right:0,width:"100%",height:"100%",opacity:0,margin:0,padding:0}).each(function(){if(n.parent("div.jq-file").length<1){function i(){var i=new r;var s=e("<div"+i.id+' class="jq-file'+i.classes+'"'+i.title+' style="display: inline-block; position: relative; overflow: hidden"></div>');var o=e('<div class="jq-file__name">'+t.filePlaceholder+"</div>").appendTo(s);var u=e('<div class="jq-file__browse">'+t.fileBrowse+"</div>").appendTo(s);n.after(s);s.append(n);if(n.is(":disabled"))s.addClass("disabled");n.change(function(){o.text(n.val().replace(/.+[\\\/]/,""));if(n.val()=="")o.text(t.filePlaceholder)}).focus(function(){s.addClass("focused")}).blur(function(){s.removeClass("focused")}).click(function(){s.removeClass("focused")})}i();n.on("refresh",function(){n.parent().before(n).remove();i()})}})}else if(n.is("select")){n.each(function(){if(n.parent("div.jqselect").length<1){function s(){function s(t){t.off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",function(t){var n=null;if(t.type=="mousewheel"){n=t.originalEvent.wheelDelta*-1}else if(t.type=="DOMMouseScroll"){n=40*t.originalEvent.detail}if(n){t.stopPropagation();t.preventDefault();e(this).scrollTop(n+e(this).scrollTop())}})}function a(){for(i=0,len=o.length;i<len;i++){var e="",t="",n="",r="",s="",a="";var f="disabled";var l="selected sel disabled";if(o.eq(i).prop("selected"))t="selected sel";if(o.eq(i).is(":disabled"))t=f;if(o.eq(i).is(":selected:disabled"))t=l;if(o.eq(i).attr("class")!==undefined){r=" "+o.eq(i).attr("class");a=' data-jqfs-class="'+o.eq(i).attr("class")+'"'}var c=o.eq(i).data();for(var h in c){if(c[h]!="")n+=" data-"+h+'="'+c[h]+'"'}e="<li"+a+n+' class="'+t+r+'">'+o.eq(i).text()+"</li>";if(o.eq(i).parent().is("optgroup")){if(o.eq(i).parent().attr("class")!==undefined)s=" "+o.eq(i).parent().attr("class");e="<li"+a+' class="'+t+r+" option"+s+'">'+o.eq(i).text()+"</li>";if(o.eq(i).is(":first-child")){e='<li class="optgroup'+s+'">'+o.eq(i).parent().attr("label")+"</li>"+e}}u+=e}}function f(){var i=new r;var f=e("<div"+i.id+' class="jq-selectbox jqselect'+i.classes+'" style="display: inline-block; position: relative; z-index:'+t.singleSelectzIndex+'">'+'<div class="jq-selectbox__select"'+i.title+' style="position: relative">'+'<div class="jq-selectbox__select-text"></div>'+'<div class="jq-selectbox__trigger"><div class="jq-selectbox__trigger-arrow"></div></div>'+"</div>"+"</div>");n.css({margin:0,padding:0}).after(f).prependTo(f);var l=e("div.jq-selectbox__select",f);var c=e("div.jq-selectbox__select-text",f);var h=o.filter(":selected");if(h.length){c.html(h.text())}else{c.html(o.first().text())}a();var p="";if(t.selectSearch)p='<div class="jq-selectbox__search"><input type="search" autocomplete="off" placeholder="'+t.selectSearchPlaceholder+'"></div>'+'<div class="jq-selectbox__not-found">'+t.selectSearchNotFound+"</div>";var d=e('<div class="jq-selectbox__dropdown" style="position: absolute">'+p+'<ul style="position: relative; list-style: none; overflow: auto; overflow-x: hidden">'+u+"</ul>"+"</div>");f.append(d);var v=e("ul",d);var m=e("li",d);var g=e("input",d);var y=e("div.jq-selectbox__not-found",d).hide();if(m.length<t.selectSearchLimit)g.parent().hide();var b=0,w=0;m.each(function(){var t=e(this);t.css({display:"inline-block","white-space":"nowrap"});if(t.innerWidth()>b){b=t.innerWidth();w=t.width()}t.css({display:"block"})});var E=f.clone().appendTo("body").width("auto");var S=E.width();E.remove();if(S==f.width()){c.width(w);b+=f.find("div.jq-selectbox__trigger").width()}if(b>f.width()){d.width(b)}n.css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0});var x=f.outerHeight();var T=g.outerHeight();var N=v.css("max-height");var C=m.filter(".selected");if(C.length<1)m.first().addClass("selected sel");if(m.data("li-height")===undefined)m.data("li-height",m.outerHeight());var k=d.css("top");if(d.css("left")=="auto")d.css({left:0});if(d.css("top")=="auto")d.css({top:x});d.hide();if(C.length){if(o.first().text()!=h.text()){f.addClass("changed")}f.data("jqfs-class",C.data("jqfs-class"));f.addClass(C.data("jqfs-class"))}if(n.is(":disabled")){f.addClass("disabled");return false}l.click(function(){n.focus();if(e("div.jq-selectbox").filter(".opened").length){t.onSelectClosed.call(e("div.jq-selectbox").filter(".opened"))}if(t.selectSmartPositioning){var r=e(window);var i=f.offset().top;var o=r.height()-x-(i-r.scrollTop());var u=t.selectVisibleOptions;var a=m.data("li-height");var l=a*5;var c=a*u;if(u>0&&u<6)l=c;if(u==0)c="auto";if(o>l+T+20){d.height("auto").css({bottom:"auto",top:k});function h(){v.css("max-height",Math.floor((o-20-T)/a)*a)}h();v.css("max-height",c);if(N!="none"){v.css("max-height",N)}if(o<d.outerHeight()+20){h()}}else{d.height("auto").css({top:"auto",bottom:k});function p(){v.css("max-height",Math.floor((i-r.scrollTop()-20-T)/a)*a)}p();v.css("max-height",c);if(N!="none"){v.css("max-height",N)}if(i-r.scrollTop()-20<d.outerHeight()+20){p()}}}e("div.jqselect").css({zIndex:t.singleSelectzIndex-1}).removeClass("opened focused");f.css({zIndex:t.singleSelectzIndex});if(d.is(":hidden")){e("div.jq-selectbox__dropdown:visible").hide();d.show();f.addClass("opened");t.onSelectOpened.call(f)}else{d.hide();f.removeClass("opened");if(e("div.jq-selectbox").filter(".opened").length){t.onSelectClosed.call(f)}}if(m.filter(".selected").length){if(v.innerHeight()/a%2!=0)a=a/2;v.scrollTop(v.scrollTop()+m.filter(".selected").position().top-v.innerHeight()/2+a)}if(g.length){g.val("").keyup();y.hide();g.focus().keyup(function(){var t=e(this).val();m.each(function(){if(!e(this).html().match(new RegExp(".*?"+t+".*?","i"))){e(this).hide()}else{e(this).show()}});if(m.filter(":visible").length<1){y.show()}else{y.hide()}})}s(v);return false});m.hover(function(){e(this).siblings().removeClass("selected")});var L=m.filter(".selected").text();var A=m.filter(".selected").text();m.filter(":not(.disabled):not(.optgroup)").click(function(){var r=e(this);var i=r.text();if(L!=i){var s=r.index();if(r.is(".option"))s-=r.prevAll(".optgroup").length;r.addClass("selected sel").siblings().removeClass("selected sel");o.prop("selected",false).eq(s).prop("selected",true);L=i;c.html(i);if(o.first().text()!=i){f.addClass("changed")}else{f.removeClass("changed")}if(f.data("jqfs-class"))f.removeClass(f.data("jqfs-class"));f.data("jqfs-class",r.data("jqfs-class"));f.addClass(r.data("jqfs-class"));n.change()}if(g.length){g.val("").keyup();y.hide()}d.hide();f.removeClass("opened");t.onSelectClosed.call(f)});d.mouseout(function(){e("li.sel",d).addClass("selected")});n.change(function(){c.html(o.filter(":selected").text());m.removeClass("selected sel").not(".optgroup").eq(n[0].selectedIndex).addClass("selected sel")}).focus(function(){f.addClass("focused")}).blur(function(){f.removeClass("focused")}).on("keydown keyup",function(e){c.text(o.filter(":selected").text());m.removeClass("selected sel").not(".optgroup").eq(n[0].selectedIndex).addClass("selected sel");if(e.which==38||e.which==37||e.which==33){d.scrollTop(d.scrollTop()+m.filter(".selected").position().top)}if(e.which==40||e.which==39||e.which==34){d.scrollTop(d.scrollTop()+m.filter(".selected").position().top-d.innerHeight()+liHeight)}if(e.which==13){d.hide()}});e(document).on("click",function(n){if(!e(n.target).parents().hasClass("jq-selectbox")&&n.target.nodeName!="OPTION"){if(e("div.jq-selectbox").filter(".opened").length){t.onSelectClosed.call(e("div.jq-selectbox").filter(".opened"))}if(g.length)g.val("").keyup();d.hide().find("li.sel").addClass("selected");f.removeClass("focused opened")}})}function l(){var t=new r;var i=e("<div"+t.id+' class="jq-select-multiple jqselect'+t.classes+'"'+t.title+' style="display: inline-block; position: relative"></div>');n.css({margin:0,padding:0}).after(i);a();i.append("<ul>"+u+"</ul>");var f=e("ul",i).css({position:"relative","overflow-x":"hidden","-webkit-overflow-scrolling":"touch"});var l=e("li",i).attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none","white-space":"nowrap"});var c=n.attr("size");var h=f.outerHeight();var p=l.outerHeight();if(c!==undefined&&c>0){f.css({height:p*c})}else{f.css({height:p*4})}if(h>i.height()){f.css("overflowY","scroll");s(f);if(l.filter(".selected").length){f.scrollTop(f.scrollTop()+l.filter(".selected").position().top)}}n.prependTo(i).css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0});if(n.is(":disabled")){i.addClass("disabled");o.each(function(){if(e(this).is(":selected"))l.eq(e(this).index()).addClass("selected")})}else{l.filter(":not(.disabled):not(.optgroup)").click(function(t){n.focus();i.removeClass("focused");var r=e(this);if(!t.ctrlKey&&!t.metaKey)r.addClass("selected");if(!t.shiftKey)r.addClass("first");if(!t.ctrlKey&&!t.metaKey&&!t.shiftKey)r.siblings().removeClass("selected first");if(t.ctrlKey||t.metaKey){if(r.is(".selected"))r.removeClass("selected first");else r.addClass("selected first");r.siblings().removeClass("first")}if(t.shiftKey){var s=false,u=false;r.siblings().removeClass("selected").siblings(".first").addClass("selected");r.prevAll().each(function(){if(e(this).is(".first"))s=true});r.nextAll().each(function(){if(e(this).is(".first"))u=true});if(s){r.prevAll().each(function(){if(e(this).is(".selected"))return false;else e(this).not(".disabled, .optgroup").addClass("selected")})}if(u){r.nextAll().each(function(){if(e(this).is(".selected"))return false;else e(this).not(".disabled, .optgroup").addClass("selected")})}if(l.filter(".selected").length==1)r.addClass("first")}o.prop("selected",false);l.filter(".selected").each(function(){var t=e(this);var n=t.index();if(t.is(".option"))n-=t.prevAll(".optgroup").length;o.eq(n).prop("selected",true)});n.change()});o.each(function(t){e(this).data("optionIndex",t)});n.change(function(){l.removeClass("selected");var t=[];o.filter(":selected").each(function(){t.push(e(this).data("optionIndex"))});l.not(".optgroup").filter(function(n){return e.inArray(n,t)>-1}).addClass("selected")}).focus(function(){i.addClass("focused")}).blur(function(){i.removeClass("focused")});if(h>i.height()){n.keydown(function(e){if(e.which==38||e.which==37||e.which==33){f.scrollTop(f.scrollTop()+l.filter(".selected").position().top-p)}if(e.which==40||e.which==39||e.which==34){f.scrollTop(f.scrollTop()+l.filter(".selected:last").position().top-f.innerHeight()+p*2)}})}}}var o=e("option",n);var u="";if(n.is("[multiple]"))l();else f()}s();n.on("refresh",function(){n.parent().before(n).remove();s()})}})}else if(n.is(":reset")){n.click(function(){setTimeout(function(){n.closest(t.wrapper).find("input, select").trigger("refresh")},1)})}}).promise().done(function(){t.onFormStyled.call()})}})(jQuery)